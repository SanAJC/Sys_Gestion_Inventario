# Python Django
# Test a Django project on multiple versions of Python.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- main

pool:
  name: 'Default' 
  
strategy:
  matrix:
    Python312:
      PYTHON_VERSION: '3.12.10'
  maxParallel: 1

steps:
- script: |
    REM 2) Crear y activar el venv
    python -m venv .venv
    call .venv\Scripts\Activate.bat

    REM 3) Verificar que estamos usando el Python del venv
    where python
    python --version

    REM 4) Instalar dependencias dentro del venv
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Preparar venv e instalar dependencias'
  failOnStderr: false

- script: |
    call .venv\Scripts\activate
    python manage.py test
  displayName: 'Ejecutar tests en venv'
